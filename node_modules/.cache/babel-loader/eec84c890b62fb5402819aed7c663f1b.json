{"ast":null,"code":"import _objectSpread from\"/home/deathsmell/WebstormProjects/i-note-common/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/deathsmell/WebstormProjects/i-note-common/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/deathsmell/WebstormProjects/i-note-common/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable react-hooks/exhaustive-deps */import React,{useEffect,useState}from\"react\";import{Rnd}from\"react-rnd\";import useNote from\"../hooks/note.hook\";import{TypeMessage}from\"../hooks/TypeMessage\";import ReactMarkdown from'react-markdown';var Note=function Note(_ref){var focus=_ref.focus,setFocus=_ref.setFocus,note=_ref.note,color=_ref.color,noteIndex=_ref.noteIndex,notes=_ref.notes,setNotes=_ref.setNotes,connection=_ref.connection;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),changed=_useState2[0],setChanged=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),zIndex=_useState4[0],setZIndex=_useState4[1];var _useState5=useState(note.text),_useState6=_slicedToArray(_useState5,2),text=_useState6[0],setText=_useState6[1];var _useNote=useNote(),updateNote=_useNote.updateNote,isEqual=_useNote.isEqual;useEffect(function resetZIndex(){setZIndex(0);return function(){setZIndex(0);};},[]);useEffect(function liftingComponent(){if(focus){setZIndex(1);}else{setZIndex(0);}},[focus]);var updateStateNotes=function updateStateNotes(updatedNote){setNotes(function(){return[].concat(_toConsumableArray(notes.filter(function(note){return note.id!==updatedNote.id;})),[updatedNote]);});};var sendNewPosition=function sendNewPosition(type,note){return connection.send(JSON.stringify(_objectSpread({},note,{type:type})));};var onDragStopHandler=function onDragStopHandler(event,data){if(note.x!==data.x&&data.y!==note.y){var updatedNote=updateNote(note,{x:data.x,y:data.y});sendNewPosition(TypeMessage.UPDATE,updatedNote);updateStateNotes(updatedNote);}};var onResizeStopHandler=function onResizeStopHandler(e,direction,ref,delta,position){var updatedNote=updateNote(note,{width:ref.style.width,height:ref.style.height,x:position.x,y:position.y});if(!isEqual(note,updatedNote)){updateStateNotes(updatedNote);sendNewPosition(TypeMessage.UPDATE,updatedNote);}};var deleteNoteHandler=function deleteNoteHandler(){sendNewPosition(TypeMessage.DELETE,note);setNotes(function(prev){return _toConsumableArray(prev.filter(function(noteFromState){return noteFromState.id!==note.id;}));});};var changeColorHandler=function changeColorHandler(e){var changeColor=e.target.value;if(changeColor!==color){console.log(\"update color\");var updatedNote=updateNote(note,{color:changeColor});updateStateNotes(updatedNote);sendNewPosition(TypeMessage.UPDATE,updatedNote);}};var changeTextHandler=function changeTextHandler(e){var text=e.target.value;setText(text);};useEffect(function saveChangeText(){if(!changed){var updatedNote=updateNote(note,{text:text});updateStateNotes(updatedNote);sendNewPosition(TypeMessage.UPDATE,updatedNote);}},[changed]);return/*#__PURE__*/React.createElement(Rnd,{className:\"note\",disableDragging:focus,style:{zIndex:zIndex},size:{width:notes[noteIndex].width,height:notes[noteIndex].height},minWidth:250,minHeight:250,position:{x:notes[noteIndex].x,y:notes[noteIndex].y},onDragStop:onDragStopHandler,onResizeStop:onResizeStopHandler,bounds:\"window\"},/*#__PURE__*/React.createElement(\"div\",{className:\"note-header\",style:{backgroundColor:color||\"gold\"},onClick:function onClick(){return setZIndex(1);},onMouseLeave:function onMouseLeave(){return setZIndex(0);}},/*#__PURE__*/React.createElement(\"div\",{className:\"color-buttons\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn blue\",value:\"blue\",onClick:changeColorHandler}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn pink\",value:\"pink\",onClick:changeColorHandler}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn yellow\",value:\"yellow\",onClick:changeColorHandler})),/*#__PURE__*/React.createElement(\"div\",{className:\"cross\",onClick:deleteNoteHandler},\"\\xD7\")),changed?/*#__PURE__*/React.createElement(\"textarea\",{className:\"note-text\",value:text,onChange:changeTextHandler,autoFocus:true,onBlur:function onBlur(){setChanged(false);setFocus(false);}}):/*#__PURE__*/React.createElement(\"div\",{id:\"preview\",className:\"note-body\",onClick:function onClick(){setChanged(true);setFocus(true);}},/*#__PURE__*/React.createElement(ReactMarkdown,null,text)));};export default Note;","map":{"version":3,"sources":["/home/deathsmell/WebstormProjects/i-note-common/src/components/Note.jsx"],"names":["React","useEffect","useState","Rnd","useNote","TypeMessage","ReactMarkdown","Note","focus","setFocus","note","color","noteIndex","notes","setNotes","connection","changed","setChanged","zIndex","setZIndex","text","setText","updateNote","isEqual","resetZIndex","liftingComponent","updateStateNotes","updatedNote","filter","id","sendNewPosition","type","send","JSON","stringify","onDragStopHandler","event","data","x","y","UPDATE","onResizeStopHandler","e","direction","ref","delta","position","width","style","height","deleteNoteHandler","DELETE","prev","noteFromState","changeColorHandler","changeColor","target","value","console","log","changeTextHandler","saveChangeText","backgroundColor"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, {useEffect, useState} from \"react\"\nimport {Rnd} from \"react-rnd\"\nimport useNote from \"../hooks/note.hook\";\nimport {TypeMessage} from \"../hooks/TypeMessage\";\nimport ReactMarkdown from 'react-markdown'\n\n\nconst Note = ({focus, setFocus, note, color, noteIndex, notes, setNotes, connection}) => {\n\n    const [changed, setChanged] = useState(false);\n    const [zIndex, setZIndex] = useState(1);\n    const [text, setText] = useState(note.text);\n    const {updateNote, isEqual} = useNote();\n\n    useEffect(function resetZIndex () {\n        setZIndex(0)\n        return () => {\n            setZIndex(0)\n        }\n    }, [])\n\n    useEffect(function liftingComponent (){\n        if (focus){\n            setZIndex(1)\n        } else {\n            setZIndex(0)\n        }\n    },[focus])\n\n    const updateStateNotes = (updatedNote) => {\n        setNotes(() => [...notes.filter(note => note.id !== updatedNote.id), updatedNote])\n    }\n    const sendNewPosition = (type, note) =>\n        connection.send(JSON.stringify({...note, type}))\n\n    const onDragStopHandler = (event, data) => {\n        if (note.x !== data.x && data.y !== note.y) {\n            const updatedNote = updateNote(note, {x: data.x, y: data.y});\n            sendNewPosition(TypeMessage.UPDATE, updatedNote)\n            updateStateNotes(updatedNote)\n        }\n    }\n\n    const onResizeStopHandler = (e, direction, ref, delta, position) => {\n        const updatedNote = updateNote(note, {\n            width: ref.style.width,\n            height: ref.style.height,\n            x: position.x,\n            y: position.y,\n        });\n        if (!isEqual(note, updatedNote)) {\n            updateStateNotes(updatedNote)\n            sendNewPosition(TypeMessage.UPDATE, updatedNote)\n        }\n    }\n\n    const deleteNoteHandler = () => {\n        sendNewPosition(TypeMessage.DELETE, note)\n        setNotes((prev) => [...prev.filter(noteFromState => noteFromState.id !== note.id)])\n    }\n\n    const changeColorHandler = (e) => {\n        const changeColor = e.target.value;\n        if (changeColor !== color) {\n            console.log(\"update color\")\n            const updatedNote = updateNote(note, {color: changeColor});\n            updateStateNotes(updatedNote)\n            sendNewPosition(TypeMessage.UPDATE, updatedNote)\n        }\n    }\n\n    const changeTextHandler = (e) => {\n        const text = e.target.value;\n        setText(text)\n    }\n\n    useEffect(function saveChangeText() {\n        if (!changed) {\n            const updatedNote = updateNote(note, {text});\n            updateStateNotes(updatedNote)\n            sendNewPosition(TypeMessage.UPDATE, updatedNote)\n        }\n    }, [changed])\n\n\n    return (\n        <Rnd\n            className=\"note\"\n            disableDragging={focus}\n            style={{zIndex: zIndex}}\n            size={{width: notes[noteIndex].width, height: notes[noteIndex].height}}\n            minWidth={250}\n            minHeight={250}\n            position={{x: notes[noteIndex].x, y: notes[noteIndex].y}}\n            onDragStop={onDragStopHandler}\n            onResizeStop={onResizeStopHandler}\n            bounds={\"window\"}\n        >\n            <div className=\"note-header\"\n                 style={{backgroundColor: color || \"gold\"}}\n                 onClick={() => setZIndex(1)}\n                 onMouseLeave={() => setZIndex(0)}\n            >\n                <div className=\"color-buttons\">\n                    <button className=\"btn blue\"\n                            value=\"blue\"\n                            onClick={changeColorHandler}\n                    />\n                    <button className=\"btn pink\"\n                            value=\"pink\"\n                            onClick={changeColorHandler}\n                    />\n                    <button className=\"btn yellow\"\n                            value=\"yellow\"\n                            onClick={changeColorHandler}\n                    />\n                </div>\n                <div className=\"cross\"\n                     onClick={deleteNoteHandler}\n                >\n                    &times;\n                </div>\n            </div>\n            {\n                changed\n                    ? (\n                        <textarea\n                            className=\"note-text\"\n                            value={text}\n                            onChange={changeTextHandler}\n                            autoFocus\n                            onBlur={() => {\n                                setChanged(false)\n                                setFocus(false)\n                            }}\n                        />\n\n                    )\n                    : (\n                        <div id=\"preview\"\n                             className=\"note-body\"\n                             onClick={() => {\n                                 setChanged(true)\n                                 setFocus(true)\n                             }}\n                        >\n                            <ReactMarkdown>\n                                {text}\n                            </ReactMarkdown>\n                        </div>\n                    )\n            }\n        </Rnd>\n    )\n}\n\nexport default Note"]},"metadata":{},"sourceType":"module"}