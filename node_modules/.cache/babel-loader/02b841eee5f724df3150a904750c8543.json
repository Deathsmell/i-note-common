{"ast":null,"code":"// import {Client} from \"@stomp/stompjs\";\nimport WebSocket from 'ws';\nimport { useEffect, useState } from \"react\";\n\nconst useWebSocket = isAuthenticated => {\n  const [stompClient, setStompClient] = useState(null);\n  const [hasConnect, setHasConnect] = useState(false);\n  let handlers = [];\n  useEffect(() => {\n    if (isAuthenticated) connect();\n  }, [isAuthenticated]);\n  useEffect(() => {\n    if (stompClient) {\n      setTimeout(() => setHasConnect(true), 1000);\n    } else {\n      setHasConnect(false);\n    }\n  }, [stompClient]);\n\n  const connect = () => {\n    const client = new WebSocket(\"ws://localhost:8080\");\n\n    client.onConnect = function (frame) {// Do something, all subscribes must be done is this callback\n      // This is needed because this will be executed after a (re)connect\n    };\n\n    client.onStompError = function (frame) {\n      // Will be invoked in case of error encountered at Broker\n      // Bad login/passcode typically will cause an error\n      // Complaint brokers will set `message` header with a brief message. Body may contain details.\n      // Compliant brokers will terminate the connection after any error\n      console.log('Broker reported error: ' + frame.headers['message']);\n      console.log('Additional details: ' + frame.body);\n    };\n\n    console.log(\"connecting\");\n    client.activate();\n  };\n\n  const addHandler = handler => handlers.push(handler);\n\n  const responseHandler = iMassage => {\n    handlers.forEach(handler => {\n      console.log(\"HANDLER: \", iMassage, handler);\n      handler(iMassage);\n    });\n  };\n\n  const subscribe = topic => {\n    if (hasConnect) {\n      return stompClient.subscribe(topic, responseHandler);\n    }\n  };\n\n  const sendMessage = (to, message = \"\") => {\n    message = typeof message === \"string\" ? \"\" : JSON.stringify(message);\n    stompClient.send(`/app${to}`, {}, message);\n  };\n\n  const disconnect = () => {\n    if (stompClient !== null) {\n      stompClient.disconnect();\n      console.log(\"Disconnected\");\n    } else {\n      console.log(\"Stomp client dont exist!\");\n    }\n  };\n\n  return {\n    connect,\n    disconnect,\n    subscribe,\n    sendMessage,\n    addHandler,\n    hasConnect\n  };\n};\n\nexport default useWebSocket;","map":{"version":3,"sources":["/home/deathsmell/WebstormProjects/i-note-common/src/hooks/ws.hooks.js"],"names":["WebSocket","useEffect","useState","useWebSocket","isAuthenticated","stompClient","setStompClient","hasConnect","setHasConnect","handlers","connect","setTimeout","client","onConnect","frame","onStompError","console","log","headers","body","activate","addHandler","handler","push","responseHandler","iMassage","forEach","subscribe","topic","sendMessage","to","message","JSON","stringify","send","disconnect"],"mappings":"AAAA;AACA,OAAOA,SAAP,MAAsB,IAAtB;AACA,SAAQC,SAAR,EAAmBC,QAAnB,QAAkC,OAAlC;;AAEA,MAAMC,YAAY,GAAIC,eAAD,IAAqB;AAEtC,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgCJ,QAAQ,CAAC,IAAD,CAA9C;AACA,QAAM,CAACK,UAAD,EAAaC,aAAb,IAA8BN,QAAQ,CAAC,KAAD,CAA5C;AACA,MAAIO,QAAQ,GAAG,EAAf;AAEAR,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAIG,eAAJ,EAAqBM,OAAO;AAC/B,GAFQ,EAEN,CAACN,eAAD,CAFM,CAAT;AAIAH,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAII,WAAJ,EAAiB;AACbM,MAAAA,UAAU,CAAC,MAAMH,aAAa,CAAC,IAAD,CAApB,EAA4B,IAA5B,CAAV;AACH,KAFD,MAEO;AACHA,MAAAA,aAAa,CAAC,KAAD,CAAb;AACH;AACJ,GANQ,EAMN,CAACH,WAAD,CANM,CAAT;;AAQA,QAAMK,OAAO,GAAG,MAAM;AAClB,UAAME,MAAM,GAAG,IAAIZ,SAAJ,CAAc,qBAAd,CAAf;;AACAY,IAAAA,MAAM,CAACC,SAAP,GAAmB,UAAUC,KAAV,EAAiB,CAChC;AACA;AACH,KAHD;;AAKAF,IAAAA,MAAM,CAACG,YAAP,GAAsB,UAAUD,KAAV,EAAiB;AACnC;AACA;AACA;AACA;AACAE,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAA4BH,KAAK,CAACI,OAAN,CAAc,SAAd,CAAxC;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAyBH,KAAK,CAACK,IAA3C;AACH,KAPD;;AAQAH,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACAL,IAAAA,MAAM,CAACQ,QAAP;AACH,GAjBD;;AAmBA,QAAMC,UAAU,GAAGC,OAAO,IAAIb,QAAQ,CAACc,IAAT,CAAcD,OAAd,CAA9B;;AAEA,QAAME,eAAe,GAAIC,QAAD,IAAc;AAClChB,IAAAA,QAAQ,CAACiB,OAAT,CAAiBJ,OAAO,IAAI;AACxBN,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBQ,QAAzB,EAAmCH,OAAnC;AACAA,MAAAA,OAAO,CAACG,QAAD,CAAP;AACH,KAHD;AAIH,GALD;;AAOA,QAAME,SAAS,GAAIC,KAAD,IAAW;AACzB,QAAIrB,UAAJ,EAAgB;AACZ,aAAOF,WAAW,CAACsB,SAAZ,CAAsBC,KAAtB,EAA6BJ,eAA7B,CAAP;AACH;AACJ,GAJD;;AAMA,QAAMK,WAAW,GAAG,CAACC,EAAD,EAAKC,OAAO,GAAG,EAAf,KAAsB;AACtCA,IAAAA,OAAO,GAAG,OAAOA,OAAP,KAAmB,QAAnB,GAA8B,EAA9B,GAAmCC,IAAI,CAACC,SAAL,CAAeF,OAAf,CAA7C;AACA1B,IAAAA,WAAW,CAAC6B,IAAZ,CAAkB,OAAMJ,EAAG,EAA3B,EAA8B,EAA9B,EAAkCC,OAAlC;AACH,GAHD;;AAKA,QAAMI,UAAU,GAAG,MAAM;AACrB,QAAI9B,WAAW,KAAK,IAApB,EAA0B;AACtBA,MAAAA,WAAW,CAAC8B,UAAZ;AACAnB,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACH,KAHD,MAGO;AACHD,MAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACH;AACJ,GAPD;;AASA,SAAO;AAACP,IAAAA,OAAD;AAAUyB,IAAAA,UAAV;AAAsBR,IAAAA,SAAtB;AAAiCE,IAAAA,WAAjC;AAA8CR,IAAAA,UAA9C;AAA0Dd,IAAAA;AAA1D,GAAP;AACH,CAnED;;AAqEA,eAAeJ,YAAf","sourcesContent":["// import {Client} from \"@stomp/stompjs\";\nimport WebSocket from 'ws'\nimport {useEffect, useState} from \"react\";\n\nconst useWebSocket = (isAuthenticated) => {\n\n    const [stompClient, setStompClient] = useState(null)\n    const [hasConnect, setHasConnect] = useState(false)\n    let handlers = []\n\n    useEffect(() => {\n        if (isAuthenticated) connect()\n    }, [isAuthenticated])\n\n    useEffect(() => {\n        if (stompClient) {\n            setTimeout(() => setHasConnect(true), 1000)\n        } else {\n            setHasConnect(false)\n        }\n    }, [stompClient])\n\n    const connect = () => {\n        const client = new WebSocket(\"ws://localhost:8080\")\n        client.onConnect = function (frame) {\n            // Do something, all subscribes must be done is this callback\n            // This is needed because this will be executed after a (re)connect\n        };\n\n        client.onStompError = function (frame) {\n            // Will be invoked in case of error encountered at Broker\n            // Bad login/passcode typically will cause an error\n            // Complaint brokers will set `message` header with a brief message. Body may contain details.\n            // Compliant brokers will terminate the connection after any error\n            console.log('Broker reported error: ' + frame.headers['message']);\n            console.log('Additional details: ' + frame.body);\n        };\n        console.log(\"connecting\")\n        client.activate()\n    }\n\n    const addHandler = handler => handlers.push(handler)\n\n    const responseHandler = (iMassage) => {\n        handlers.forEach(handler => {\n            console.log(\"HANDLER: \", iMassage, handler)\n            handler(iMassage)\n        })\n    }\n\n    const subscribe = (topic) => {\n        if (hasConnect) {\n            return stompClient.subscribe(topic, responseHandler);\n        }\n    }\n\n    const sendMessage = (to, message = \"\") => {\n        message = typeof message === \"string\" ? \"\" : JSON.stringify(message)\n        stompClient.send(`/app${to}`, {}, message)\n    }\n\n    const disconnect = () => {\n        if (stompClient !== null) {\n            stompClient.disconnect()\n            console.log(\"Disconnected\")\n        } else {\n            console.log(\"Stomp client dont exist!\")\n        }\n    }\n\n    return {connect, disconnect, subscribe, sendMessage, addHandler, hasConnect}\n}\n\nexport default useWebSocket"]},"metadata":{},"sourceType":"module"}